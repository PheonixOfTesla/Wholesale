<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WholesalePro Ultimate - Complete Wholesaling System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f3f4f6;
            --white: #ffffff;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        
        .header {
            background: var(--dark);
            color: var(--white);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-stats {
            display: flex;
            gap: 30px;
            margin-top: 10px;
        }
        
        .header-stat {
            text-align: center;
        }
        
        .header-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .header-stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .nav-tabs {
            background: var(--light);
            padding: 0 20px;
            display: flex;
            gap: 5px;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--dark);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--white);
        }
        
        .content {
            padding: 30px;
            min-height: 500px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--white);
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .stat-card h3 {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: var(--dark);
        }
        
        .stat-card .change {
            font-size: 12px;
            margin-top: 5px;
        }
        
        .stat-card .change.positive {
            color: var(--success);
        }
        
        .stat-card .change.negative {
            color: var(--danger);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--dark);
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-group .error {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .error-message {
            color: var(--danger);
            font-size: 12px;
            margin-top: 5px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .btn-success {
            background: var(--success);
            color: var(--white);
        }
        
        .btn-success:hover:not(:disabled) {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }
        
        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: var(--white);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }
        
        .table-container {
            overflow-x: auto;
            background: var(--white);
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: var(--light);
            padding: 12px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: var(--dark);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 14px;
        }
        
        tr:hover {
            background: #f9fafb;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-new {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-contacted {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-offer {
            background: #ede9fe;
            color: #5b21b6;
        }
        
        .status-contract {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-sold {
            background: #10b981;
            color: white;
        }
        
        .status-dead {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--white);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 20px;
            color: var(--dark);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-btn:hover {
            background: #f3f4f6;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .calculator-result {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .calculator-result h3 {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .calculator-result .amount {
            font-size: 36px;
            font-weight: bold;
        }
        
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        .quick-stat {
            text-align: center;
        }
        
        .quick-stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .quick-stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: var(--success);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .nav-tabs {
                padding: 0 10px;
            }
            
            .nav-tab {
                padding: 12px 15px;
                font-size: 13px;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .empty-state p {
            margin-bottom: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .task-board {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .task-column {
            padding: 20px;
            border-radius: 12px;
            min-height: 200px;
        }
        
        .task-column.todo {
            background: #fef3c7;
        }
        
        .task-column.progress {
            background: #dbeafe;
        }
        
        .task-column.completed {
            background: #d1fae5;
        }
        
        .task-column h3 {
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .task-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid;
            cursor: move;
        }
        
        .task-card.high {
            border-left-color: var(--danger);
        }
        
        .task-card.medium {
            border-left-color: var(--warning);
        }
        
        .task-card.low {
            border-left-color: #6b7280;
        }
        
        .task-title {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .task-meta {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 10px;
        }
        
        .task-actions {
            display: flex;
            gap: 5px;
        }
        
        .task-actions button {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        .leads-match {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .leads-match h4 {
            color: #0284c7;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .leads-match p {
            font-size: 12px;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>⚡ WholesalePro Ultimate</h1>
                <div class="header-stats">
                    <div class="header-stat">
                        <div class="header-stat-value" id="totalDealsValue">$0</div>
                        <div class="header-stat-label">Pipeline Value</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value" id="activeLeadsCount">0</div>
                        <div class="header-stat-label">Active Leads</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value" id="monthlyProfit">$0</div>
                        <div class="header-stat-label">This Month</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value" id="conversionRate">0%</div>
                        <div class="header-stat-label">Conversion</div>
                    </div>
                </div>
            </div>
        </div>
        
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">📊 Dashboard</button>
            <button class="nav-tab" data-tab="leads">🏠 Leads</button>
            <button class="nav-tab" data-tab="calculator">🧮 Deal Analyzer</button>
            <button class="nav-tab" data-tab="buyers">💰 Cash Buyers</button>
            <button class="nav-tab" data-tab="campaigns">📣 Marketing</button>
            <button class="nav-tab" data-tab="hotdeals">🔥 Hot Deals</button>            <button class="nav-tab" data-tab="contracts">📄 Contracts</button>
            <button class="nav-tab" data-tab="tasks">✅ Tasks</button>
            <button class="nav-tab" data-tab="resources">🚀 Resources</button>
            <button class="nav-tab" data-tab="settings">⚙️ Settings</button>
        </nav>
        
        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2 style="margin-bottom: 20px;">Dashboard Overview</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>New Leads This Week</h3>
                        <div class="value" id="weeklyLeads">0</div>
                        <div class="change positive">↗ <span id="weeklyChange">0%</span> from last week</div>
                    </div>
                    <div class="stat-card">
                        <h3>Deals Under Contract</h3>
                        <div class="value" id="contractCount">0</div>
                        <div class="change">Worth $<span id="contractValue">0</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>Follow-ups Today</h3>
                        <div class="value" id="todayFollowups">0</div>
                        <div class="change">Next: <span id="nextFollowup">None</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>Marketing ROI</h3>
                        <div class="value" id="marketingROI">0%</div>
                        <div class="change positive">Cost per lead: $<span id="costPerLead">0</span></div>
                    </div>
                </div>
                
                <h3 style="margin: 30px 0 15px;">Recent Activity</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Property</th>
                                <th>Status</th>
                                <th>Next Action</th>
                                <th>MAO</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivity">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: #6b7280;">
                                    No recent activity. Add your first lead to get started!
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Leads Tab -->
            <div id="leads" class="tab-content">
                <div class="action-buttons">
                    <button class="btn btn-primary" id="addLeadBtn">+ Add New Lead</button>
                    <button class="btn btn-secondary" id="exportLeadsBtn">📥 Export Leads</button>
                    <button class="btn btn-success" id="matchBuyersBtn">🎯 Match Buyers</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Address</th>
                                <th>Owner</th>
                                <th>Status</th>
                                <th>ARV</th>
                                <th>Repair Est.</th>
                                <th>MAO</th>
                                <th>Profit</th>
                                <th>Follow-up</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTable">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px; color: #6b7280;">
                                    No leads yet. Click "Add New Lead" to start building your pipeline!
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Deal Analyzer Tab -->
            <div id="calculator" class="tab-content">
                <h2 style="margin-bottom: 20px;">Deal Analyzer</h2>
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label>Property Address</label>
                            <input type="text" id="calc-address" placeholder="123 Main St, City, ST 12345">
                        </div>
                        <div class="form-group">
                            <label>After Repair Value (ARV)</label>
                            <input type="number" id="calc-arv" placeholder="250000">
                        </div>
                        <div class="form-group">
                            <label>Repair Costs</label>
                            <input type="number" id="calc-repairs" placeholder="35000">
                        </div>
                        <div class="form-group">
                            <label>Assignment Fee</label>
                            <input type="number" id="calc-fee" placeholder="10000" value="10000">
                        </div>
                        <div class="form-group">
                            <label>Formula</label>
                            <select id="calc-formula">
                                <option value="70">70% Rule</option>
                                <option value="65">65% Rule (Heavy Repairs)</option>
                                <option value="75">75% Rule (Light Repairs)</option>
                                <option value="custom">Custom Percentage</option>
                            </select>
                        </div>
                        <div class="form-group" id="customPercentGroup" style="display: none;">
                            <label>Custom Percentage</label>
                            <input type="number" id="calc-custom" placeholder="72" value="70" min="50" max="90">
                        </div>
                        <div class="form-group">
                            <label>Holding Costs (Optional)</label>
                            <input type="number" id="calc-holding" placeholder="2000" value="0">
                        </div>
                        <div class="form-group">
                            <label>Closing Costs (Optional)</label>
                            <input type="number" id="calc-closing" placeholder="3000" value="0">
                        </div>
                    </div>
                    <div>
                        <div class="calculator-result">
                            <h3>Maximum Allowable Offer (MAO)</h3>
                            <div class="amount" id="maoAmount">$0</div>
                            <div class="quick-stats">
                                <div class="quick-stat">
                                    <div class="quick-stat-label">Buyer Profit</div>
                                    <div class="quick-stat-value" id="buyerProfit">$0</div>
                                </div>
                                <div class="quick-stat">
                                    <div class="quick-stat-label">Assignment Fee</div>
                                    <div class="quick-stat-value" id="assignmentFee">$10,000</div>
                                </div>
                                <div class="quick-stat">
                                    <div class="quick-stat-label">Total Investment</div>
                                    <div class="quick-stat-value" id="totalInvestment">$0</div>
                                </div>
                                <div class="quick-stat">
                                    <div class="quick-stat-label">ROI</div>
                                    <div class="quick-stat-value" id="calcROI">0%</div>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary" id="saveDealBtn" style="margin-top: 20px; width: 100%;">
                            💾 Save This Deal to Leads
                        </button>
                    </div>
                </div>
                
                <h3 style="margin: 30px 0 15px;">Repair Cost Estimator</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Square Footage</label>
                        <input type="number" id="calc-sqft" placeholder="1500">
                    </div>
                    <div class="form-group">
                        <label>Property Type</label>
                        <select id="calc-type">
                            <option value="sfh">Single Family</option>
                            <option value="condo">Condo/Townhouse</option>
                            <option value="multi">Multi-Family</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Condition Level</label>
                        <select id="calc-condition">
                            <option value="1">1 - Excellent (Cosmetic Only)</option>
                            <option value="2">2 - Good (Minor Repairs)</option>
                            <option value="3">3 - Fair (Moderate Repairs)</option>
                            <option value="4">4 - Poor (Major Repairs)</option>
                            <option value="5">5 - Terrible (Full Rehab)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Roof ($<span id="roofCost">0</span>)</label>
                        <select id="repair-roof">
                            <option value="0">Good - No Work</option>
                            <option value="3000">Minor Repairs ($3,000)</option>
                            <option value="8000">Partial Replacement ($8,000)</option>
                            <option value="15000">Full Replacement ($15,000)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Kitchen ($<span id="kitchenCost">0</span>)</label>
                        <select id="repair-kitchen">
                            <option value="0">Good - No Work</option>
                            <option value="5000">Update/Refresh ($5,000)</option>
                            <option value="15000">Moderate Remodel ($15,000)</option>
                            <option value="25000">Full Remodel ($25,000)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bathrooms ($<span id="bathCost">0</span>)</label>
                        <select id="repair-bath">
                            <option value="0">Good - No Work</option>
                            <option value="3000">Update per bath ($3,000)</option>
                            <option value="8000">Full remodel per bath ($8,000)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Flooring ($<span id="floorCost">0</span>)</label>
                        <select id="repair-floor">
                            <option value="0">Good - No Work</option>
                            <option value="3000">Partial Replacement ($3,000)</option>
                            <option value="6000">Most Flooring ($6,000)</option>
                            <option value="10000">All New Flooring ($10,000)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Paint ($<span id="paintCost">0</span>)</label>
                        <select id="repair-paint">
                            <option value="0">Good - No Work</option>
                            <option value="2000">Interior Only ($2,000)</option>
                            <option value="4000">Interior & Exterior ($4,000)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>HVAC ($<span id="hvacCost">0</span>)</label>
                        <select id="repair-hvac">
                            <option value="0">Good - No Work</option>
                            <option value="1500">Service/Minor Repair ($1,500)</option>
                            <option value="6000">Partial Replacement ($6,000)</option>
                            <option value="12000">Full System ($12,000)</option>
                        </select>
                    </div>
                </div>
                
                <div style="background: var(--light); padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <strong>Total Estimated Repairs: $<span id="totalRepairEstimate">0</span></strong>
                    <div style="margin-top: 10px; font-size: 14px; color: #6b7280;">
                        Per Sq Ft: $<span id="repairPerSqFt">0</span> | 
                        Condition Level: <span id="currentCondition">Not Set</span>
                    </div>
                </div>
            </div>
            
            <!-- Cash Buyers Tab -->
            <div id="buyers" class="tab-content">
                <div class="action-buttons">
                    <button class="btn btn-primary" id="addBuyerBtn">+ Add Cash Buyer</button>
                    <button class="btn btn-secondary" id="exportBuyersBtn">📥 Export Buyers List</button>
                    <button class="btn btn-success" id="analyzeDemanBtn">📊 Analyze Demand</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Company</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Areas</th>
                                <th>Price Range</th>
                                <th>Property Types</th>
                                <th>Last Contact</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="buyersTable">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px; color: #6b7280;">
                                    No buyers yet. Start building your buyers list!
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Marketing Campaigns Tab -->
            <div id="campaigns" class="tab-content">
                <h2 style="margin-bottom: 20px;">Marketing Campaigns</h2>
                <div class="action-buttons">
                    <button class="btn btn-primary" id="addCampaignBtn">+ New Campaign</button>
                    <button class="btn btn-secondary" id="exportCampaignsBtn">📥 Export Data</button>
                </div>
                
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Total Spend (Month)</h3>
                        <div class="value">$<span id="totalSpend">0</span></div>
                        <div class="change">Budget remaining: $<span id="budgetRemaining">0</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>Leads Generated</h3>
                        <div class="value" id="campaignLeads">0</div>
                        <div class="change positive">This month: <span id="monthlyLeads">0</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>Cost Per Lead</h3>
                        <div class="value">$<span id="campaignCPL">0</span></div>
                        <div class="change">Target: $<span id="targetCPL">100</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>Best Channel</h3>
                        <div class="value" id="bestChannel">-</div>
                        <div class="change">ROI: <span id="bestROI">0%</span></div>
                    </div>
                </div>
                
                <div class="table-container" style="margin-top: 30px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Campaign</th>
                                <th>Channel</th>
                                <th>Start Date</th>
                                <th>Budget</th>
                                <th>Spent</th>
                                <th>Leads</th>
                                <th>CPL</th>
                                <th>Conversion</th>
                                <th>ROI</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="campaignsTable">
                            <tr>
                                <td colspan="11" style="text-align: center; padding: 40px; color: #6b7280;">
                                    No campaigns yet. Track your marketing efforts!
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Contracts Tab -->
            <div id="contracts" class="tab-content">
                <h2 style="margin-bottom: 20px;">Contract Generator</h2>
                <div class="form-grid">
                    <div>
                        <h3 style="margin-bottom: 15px;">Property Information</h3>
                        <div class="form-group">
                            <label>Property Address *</label>
                            <input type="text" id="contract-address" placeholder="123 Main St, City, ST 12345" required>
                        </div>
                        <div class="form-group">
                            <label>Purchase Price *</label>
                            <input type="number" id="contract-price" placeholder="150000" required>
                        </div>
                        <div class="form-group">
                            <label>Earnest Money</label>
                            <input type="number" id="contract-earnest" placeholder="100" value="100">
                        </div>
                        <div class="form-group">
                            <label>Closing Date</label>
                            <input type="date" id="contract-closing" required>
                        </div>
                        <div class="form-group">
                            <label>Inspection Period (Days)</label>
                            <input type="number" id="contract-inspection" placeholder="7" value="7">
                        </div>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 15px;">Parties</h3>
                        <div class="form-group">
                            <label>Seller Name *</label>
                            <input type="text" id="contract-seller" placeholder="John Doe" required>
                        </div>
                        <div class="form-group">
                            <label>Buyer Name (Your Company) *</label>
                            <input type="text" id="contract-buyer" placeholder="ABC Investments LLC" required>
                        </div>
                        <div class="form-group">
                            <label>Contract Type</label>
                            <select id="contract-type">
                                <option value="purchase">Purchase Agreement</option>
                                <option value="assignment">Assignment Agreement</option>
                                <option value="option">Option Agreement</option>
                                <option value="land">Land Contract</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Assignment Fee (if applicable)</label>
                            <input type="number" id="contract-assignment-fee" placeholder="10000">
                        </div>
                        <div class="form-group">
                            <label>Title Company</label>
                            <input type="text" id="contract-title" placeholder="ABC Title Company">
                        </div>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" id="generateContractBtn">📄 Generate Contract</button>
                    <button class="btn btn-secondary" id="saveTemplateBtn">💾 Save as Template</button>
                    <button class="btn btn-secondary" id="loadTemplateBtn">📂 Load Template</button>
                </div>
                
                <div id="contractOutput" style="display: none; margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3>Generated Contract</h3>
                        <div>
                            <button class="btn btn-primary" id="printContractBtn">🖨️ Print</button>
                            <button class="btn btn-secondary" id="downloadContractBtn">📥 Download PDF</button>
                            <button class="btn btn-success" id="emailContractBtn">📧 Email</button>
                        </div>
                    </div>
                    <div style="background: white; border: 1px solid #e5e7eb; padding: 30px; border-radius: 8px;">
                        <div id="contractContent"></div>
                    </div>
                </div>
            </div>
            
<!-- HOT DEALS INJECTION -->
<!-- Hot Deals Tab Content -->
<div id="hotdeals" class="tab-content">
    <h2 style="margin-bottom: 20px;">🔥 Hot Deals Geographic Scanner</h2>
    
    <div style="background: linear-gradient(135deg, #ef4444, #f59e0b); padding: 20px; border-radius: 12px; margin-bottom: 30px; color: white;">
        <div class="form-grid" style="align-items: end;">
            <div class="form-group">
                <label style="color: white;">Center Zip Code</label>
                <input type="text" id="hotdeals-zip" placeholder="32801" value="32801">
            </div>
            <div class="form-group">
                <label style="color: white;">Radius (miles)</label>
                <select id="hotdeals-radius">
                    <option value="25">25 miles</option>
                    <option value="50">50 miles</option>
                    <option value="100" selected>100 miles</option>
                    <option value="200">200 miles</option>
                </select>
            </div>
            <div class="form-group">
                <label style="color: white;">Min Profit</label>
                <input type="number" id="hotdeals-minprofit" value="10000">
            </div>
            <div class="form-group">
                <label style="color: white;">Min Score</label>
                <input type="number" id="hotdeals-minscore" value="70" max="100">
            </div>
            <button class="btn" onclick="app.scanHotDeals()" style="background: white; color: #ef4444; font-weight: bold; padding: 12px 30px;">
                🔍 SCAN NOW
            </button>
        </div>
    </div>
    
    <div class="dashboard-grid" id="hotDealsMetrics" style="margin-bottom: 30px;">
        <div class="stat-card">
            <h3>Hottest Deal</h3>
            <div class="value" id="hottestDeal">-</div>
        </div>
        <div class="stat-card">
            <h3>Deals Found</h3>
            <div class="value" id="dealsFound">0</div>
        </div>
        <div class="stat-card">
            <h3>Avg Score</h3>
            <div class="value" id="avgScore">0</div>
        </div>
        <div class="stat-card">
            <h3>Total Profit</h3>
            <div class="value" id="totalProfit">$0</div>
        </div>
    </div>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Score</th>
                    <th>Address</th>
                    <th>Distance</th>
                    <th>Status</th>
                    <th>ARV</th>
                    <th>MAO</th>
                    <th>Profit</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="hotDealsTable">
                <tr><td colspan="8" style="text-align: center; padding: 40px;">Click "SCAN NOW" to find hot deals in your area</td></tr>
            </tbody>
        </table>
    </div>
</div>
<!-- END HOT DEALS -->
            <!-- Tasks Tab -->
            <div id="tasks" class="tab-content">
                <h2 style="margin-bottom: 20px;">Task Management</h2>
                <div class="action-buttons">
                    <button class="btn btn-primary" id="addTaskBtn">+ Add Task</button>
                    <button class="btn btn-secondary" id="exportTasksBtn">📥 Export Tasks</button>
                    <button class="btn btn-success" id="bulkActionsBtn">⚡ Bulk Actions</button>
                </div>
                
                <div class="task-board">
                    <div class="task-column todo">
                        <h3 style="color: #92400e;">📋 To Do (<span id="todoCount">0</span>)</h3>
                        <div id="todoTasks"></div>
                    </div>
                    <div class="task-column progress">
                        <h3 style="color: #1e40af;">🔄 In Progress (<span id="progressCount">0</span>)</h3>
                        <div id="progressTasks"></div>
                    </div>
                    <div class="task-column completed">
                        <h3 style="color: #065f46;">✅ Completed (<span id="completedCount">0</span>)</h3>
                        <div id="completedTasks"></div>
                    </div>
                </div>
            </div>
            
            <!-- Resources Tab -->
            <div id="resources" class="tab-content">
                <h2 style="margin-bottom: 20px;">🚀 Ultimate Wholesaling Resources</h2>
                <p style="color: #6b7280; margin-bottom: 30px;">Everything you need to dominate your market. These are the exact tools the biggest wholesalers use daily.</p>
                
                <!-- Lead Generation & Data -->
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px;">🔍 Lead Generation & Property Data</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                        <a href="https://www.propstream.com" target="_blank" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; color: white; text-decoration: none; display: block; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <strong>PropStream</strong><br>
                            <small>Complete property data, comps, skip tracing - The #1 wholesaler platform</small>
                        </a>
                        <a href="https://batchleads.io" target="_blank" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; color: white; text-decoration: none; display: block; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <strong>BatchLeads</strong><br>
                            <small>Bulk skip tracing & driving for dollars app</small>
                        </a>
                        <a href="https://www.attomdata.com" target="_blank" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; color: white; text-decoration: none; display: block; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <strong>ATTOM Data</strong><br>
                            <small>Foreclosure & auction data nationwide</small>
                        </a>
                        <a href="https://dealmachine.com" target="_blank" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; color: white; text-decoration: none; display: block; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <strong>DealMachine</strong><br>
                            <small>Drive for dollars app with auto-mailers</small>
                        </a>
                    </div>
                </div>
                
                <!-- Quick Tools -->
                <div style="background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px;">⚡ Quick Analysis Tools</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px;">Quick MAO Calculator</h4>
                            <input type="number" id="quickARV" placeholder="ARV" style="width: 100%; margin-bottom: 5px; padding: 8px; border-radius: 4px; border: none; color: black;">
                            <input type="number" id="quickRepairs" placeholder="Repairs" style="width: 100%; margin-bottom: 5px; padding: 8px; border-radius: 4px; border: none; color: black;">
                            <button id="quickCalcBtn" style="width: 100%; padding: 8px; background: white; color: #ef4444; border: none; border-radius: 4px; font-weight: bold; cursor: pointer;">Calculate MAO</button>
                            <div id="quickResult" style="margin-top: 10px; font-weight: bold;"></div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px;">Script Generator</h4>
                            <button id="phoneScriptBtn" style="width: 100%; padding: 8px; background: white; color: #ef4444; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; margin-bottom: 5px;">Phone Script</button>
                            <button id="textScriptBtn" style="width: 100%; padding: 8px; background: white; color: #ef4444; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; margin-bottom: 5px;">Text Template</button>
                            <button id="emailScriptBtn" style="width: 100%; padding: 8px; background: white; color: #ef4444; border: none; border-radius: 4px; font-weight: bold; cursor: pointer;">Email Template</button>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px;">Comp Search</h4>
                            <input type="text" id="compAddress" placeholder="Property address" style="width: 100%; margin-bottom: 5px; padding: 8px; border-radius: 4px; border: none; color: black;">
                            <button id="zillowBtn" style="width: 100%; padding: 6px; background: white; color: #ef4444; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; margin-bottom: 3px; font-size: 12px;">Zillow</button>
                            <button id="redfinBtn" style="width: 100%; padding: 6px; background: white; color: #ef4444; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 12px;">Redfin</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2 style="margin-bottom: 20px;">Settings & Data Management</h2>
                
                <div style="background: var(--light); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Data Backup & Restore</h3>
                    <p style="color: #6b7280; margin-bottom: 15px;">Your data is stored locally. Export regularly to prevent data loss.</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" id="exportAllBtn">💾 Export All Data</button>
                        <button class="btn btn-primary" id="importBtn">📂 Import Data</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                        <button class="btn btn-danger" id="clearAllBtn">🗑️ Clear All Data</button>
                        <button class="btn btn-secondary" id="resetDemoBtn">🔄 Reset to Demo Data</button>
                    </div>
                </div>
                
                <div style="background: var(--light); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Company Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Company Name</label>
                            <input type="text" id="settings-company" placeholder="Your Company LLC">
                        </div>
                        <div class="form-group">
                            <label>Your Name</label>
                            <input type="text" id="settings-name" placeholder="John Smith">
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="settings-phone" placeholder="(555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="settings-email" placeholder="john@company.com">
                        </div>
                        <div class="form-group">
                            <label>Default Assignment Fee</label>
                            <input type="number" id="settings-fee" placeholder="10000" value="10000">
                        </div>
                        <div class="form-group">
                            <label>Target Cost Per Lead</label>
                            <input type="number" id="settings-cpl" placeholder="100" value="100">
                        </div>
                    </div>
                    <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
                </div>
                
                <div style="background: var(--light); padding: 20px; border-radius: 12px;">
                    <h3 style="margin-bottom: 15px;">Performance Statistics</h3>
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <h3>Total Leads</h3>
                            <div class="value" id="statsLeads">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Buyers</h3>
                            <div class="value" id="statsBuyers">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Deals Closed</h3>
                            <div class="value" id="statsDeals">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Revenue</h3>
                            <div class="value">$<span id="statsRevenue">0</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Lead Modal -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="leadModalTitle">Add New Lead</h2>
                <button class="close-btn" data-close="leadModal">×</button>
            </div>
            <div class="modal-body">
                <form id="leadForm">
                    <div class="form-group">
                        <label>Property Address *</label>
                        <input type="text" id="lead-address" placeholder="123 Main St, City, ST 12345" required>
                        <div class="error-message" id="lead-address-error"></div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Owner Name</label>
                            <input type="text" id="lead-owner" placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="lead-phone" placeholder="(555) 123-4567">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ARV *</label>
                            <input type="number" id="lead-arv" placeholder="250000" required min="0">
                            <div class="error-message" id="lead-arv-error"></div>
                        </div>
                        <div class="form-group">
                            <label>Repair Estimate</label>
                            <input type="number" id="lead-repairs" placeholder="35000" min="0">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Status</label>
                            <select id="lead-status">
                                <option value="new">New Lead</option>
                                <option value="contacted">Contacted</option>
                                <option value="offer">Offer Made</option>
                                <option value="contract">Under Contract</option>
                                <option value="sold">Sold</option>
                                <option value="dead">Dead</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Assignment Fee</label>
                            <input type="number" id="lead-fee" placeholder="10000" value="10000" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="lead-notes" rows="3" placeholder="Add any notes about this lead..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Follow-up Date</label>
                        <input type="date" id="lead-followup">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="leadModal">Cancel</button>
                <button class="btn btn-primary" id="saveLeadBtn">Save Lead</button>
            </div>
        </div>
    </div>
    
    <!-- Buyer Modal -->
    <div id="buyerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="buyerModalTitle">Add Cash Buyer</h2>
                <button class="close-btn" data-close="buyerModal">×</button>
            </div>
            <div class="modal-body">
                <form id="buyerForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Name *</label>
                            <input type="text" id="buyer-name" placeholder="John Smith" required>
                            <div class="error-message" id="buyer-name-error"></div>
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" id="buyer-company" placeholder="ABC Investments">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Phone *</label>
                            <input type="tel" id="buyer-phone" placeholder="(555) 123-4567" required>
                            <div class="error-message" id="buyer-phone-error"></div>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="buyer-email" placeholder="buyer@email.com">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Preferred Areas (comma separated)</label>
                        <input type="text" id="buyer-areas" placeholder="Downtown, Westside, Suburbs">
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Min Price</label>
                            <input type="number" id="buyer-minprice" placeholder="50000" min="0">
                        </div>
                        <div class="form-group">
                            <label>Max Price</label>
                            <input type="number" id="buyer-maxprice" placeholder="300000" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Property Types</label>
                        <select id="buyer-types" multiple style="height: 100px;">
                            <option value="SFH">Single Family</option>
                            <option value="Multi">Multi-Family</option>
                            <option value="Condo">Condo/Townhouse</option>
                            <option value="Land">Vacant Land</option>
                            <option value="Commercial">Commercial</option>
                        </select>
                        <small style="color: #6b7280;">Hold Ctrl/Cmd to select multiple</small>
                    </div>
                    <div class="form-group">
                        <label>Cash Available</label>
                        <input type="number" id="buyer-cash" placeholder="500000" min="0">
                    </div>
                    <div class="form-group">
                        <label>Closing Timeline</label>
                        <select id="buyer-timeline">
                            <option value="7">7 days</option>
                            <option value="14">14 days</option>
                            <option value="21">21 days</option>
                            <option value="30">30 days</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="buyer-notes" rows="3" placeholder="Preferred condition, special requirements, etc."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="buyerModal">Cancel</button>
                <button class="btn btn-primary" id="saveBuyerBtn">Save Buyer</button>
            </div>
        </div>
    </div>
    
    <!-- Campaign Modal -->
    <div id="campaignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="campaignModalTitle">New Marketing Campaign</h2>
                <button class="close-btn" data-close="campaignModal">×</button>
            </div>
            <div class="modal-body">
                <form id="campaignForm">
                    <div class="form-group">
                        <label>Campaign Name *</label>
                        <input type="text" id="campaign-name" placeholder="Q1 Direct Mail Campaign" required>
                        <div class="error-message" id="campaign-name-error"></div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Channel</label>
                            <select id="campaign-channel">
                                <option value="Direct Mail">Direct Mail</option>
                                <option value="Facebook Ads">Facebook Ads</option>
                                <option value="Google Ads">Google Ads</option>
                                <option value="Bandit Signs">Bandit Signs</option>
                                <option value="Cold Calling">Cold Calling</option>
                                <option value="SMS Campaign">SMS Campaign</option>
                                <option value="SEO/Website">SEO/Website</option>
                                <option value="Driving for Dollars">Driving for Dollars</option>
                                <option value="Networking">Networking Events</option>
                                <option value="Referrals">Referral Program</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Budget *</label>
                            <input type="number" id="campaign-budget" placeholder="5000" required min="0">
                            <div class="error-message" id="campaign-budget-error"></div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" id="campaign-start">
                        </div>
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" id="campaign-end">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Target Audience</label>
                        <input type="text" id="campaign-audience" placeholder="Absentee owners, Pre-foreclosure, etc.">
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Expected Leads</label>
                            <input type="number" id="campaign-expected" placeholder="50" min="0">
                        </div>
                        <div class="form-group">
                            <label>Target CPL</label>
                            <input type="number" id="campaign-target-cpl" placeholder="100" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="campaign-notes" rows="3" placeholder="Campaign details, messaging, target criteria..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="campaignModal">Cancel</button>
                <button class="btn btn-primary" id="saveCampaignBtn">Save Campaign</button>
            </div>
        </div>
    </div>
    
    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="taskModalTitle">Add Task</h2>
                <button class="close-btn" data-close="taskModal">×</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label>Task Title *</label>
                        <input type="text" id="task-title" placeholder="Follow up with seller" required>
                        <div class="error-message" id="task-title-error"></div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="task-description" rows="3" placeholder="Task details..."></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Priority</label>
                            <select id="task-priority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Due Date</label>
                            <input type="date" id="task-due">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Related Lead</label>
                        <select id="task-lead">
                            <option value="">None</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Task Type</label>
                        <select id="task-type">
                            <option value="follow-up">Follow-up Call</option>
                            <option value="appointment">Property Appointment</option>
                            <option value="paperwork">Paperwork/Contracts</option>
                            <option value="marketing">Marketing Activity</option>
                            <option value="admin">Administrative</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="taskModal">Cancel</button>
                <button class="btn btn-primary" id="saveTaskBtn">Save Task</button>
            </div>
        </div>
    </div>
    
    <!-- Notification Container -->
    <div id="notification" class="notification"></div>
    
    <script>
        // 🚀 WHOLESALEPRO ULTIMATE - ZERO BUGS VERSION
        // Complete JavaScript Application
        
        class WholesaleProApp {
            constructor() {
                this.data = {
                    leads: [],
                    buyers: [],
                    campaigns: [],
                    tasks: [],
                    settings: {
                        company: '',
                        name: '',
                        phone: '',
                        email: '',
                        defaultFee: 10000,
                        targetCPL: 100
                    },
                    lastId: 0
                };
                
                this.currentEditId = null;
                this.currentEditType = null;
                
                this.init();
            }
            
            init() {
                this.loadData();
                this.bindEvents();
                this.updateAllDisplays();
                this.setDefaultDates();
                this.showNotification('Welcome to WholesalePro Ultimate!', 'success');
            }
            
            // === DATA MANAGEMENT ===
            loadData() {
                try {
                    const stored = localStorage.getItem('wholesaleProUltimate');
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        this.data = { ...this.data, ...parsed };
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showNotification('Error loading data. Starting fresh.', 'error');
                }
            }
            
            saveData() {
                try {
                    localStorage.setItem('wholesaleProUltimate', JSON.stringify(this.data));
                    return true;
                } catch (error) {
                    console.error('Error saving data:', error);
                    this.showNotification('Error saving data. Please try again.', 'error');
                    return false;
                }
            }
            
            generateId() {
                return ++this.data.lastId;
            }
            
            // === EVENT BINDING ===
            bindEvents() {
                // Tab switching
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
                });
                
                // Modal events
                document.querySelectorAll('[data-close]').forEach(btn => {
                    btn.addEventListener('click', (e) => this.closeModal(e.target.dataset.close));
                });
                
                // Lead events
                document.getElementById('addLeadBtn').addEventListener('click', () => this.openLeadModal());
                document.getElementById('saveLeadBtn').addEventListener('click', () => this.saveLead());
                document.getElementById('exportLeadsBtn').addEventListener('click', () => this.exportLeads());
                document.getElementById('matchBuyersBtn').addEventListener('click', () => this.matchBuyers());
                
                // Buyer events
                document.getElementById('addBuyerBtn').addEventListener('click', () => this.openBuyerModal());
                document.getElementById('saveBuyerBtn').addEventListener('click', () => this.saveBuyer());
                document.getElementById('exportBuyersBtn').addEventListener('click', () => this.exportBuyers());
                
                // Campaign events
                document.getElementById('addCampaignBtn').addEventListener('click', () => this.openCampaignModal());
                document.getElementById('saveCampaignBtn').addEventListener('click', () => this.saveCampaign());
                
                // Task events
                document.getElementById('addTaskBtn').addEventListener('click', () => this.openTaskModal());
                document.getElementById('saveTaskBtn').addEventListener('click', () => this.saveTask());
                
                // Calculator events
                document.getElementById('calc-arv').addEventListener('input', () => this.calculateDeal());
                document.getElementById('calc-repairs').addEventListener('input', () => this.calculateDeal());
                document.getElementById('calc-fee').addEventListener('input', () => this.calculateDeal());
                document.getElementById('calc-formula').addEventListener('change', () => this.calculateDeal());
                document.getElementById('calc-custom').addEventListener('input', () => this.calculateDeal());
                document.getElementById('saveDealBtn').addEventListener('click', () => this.saveDealFromCalculator());
                
                // Repair estimator events
                ['roof', 'kitchen', 'bath', 'floor', 'paint', 'hvac'].forEach(item => {
                    document.getElementById(`repair-${item}`).addEventListener('change', () => this.updateRepairEstimate());
                });
                
                // Contract events
                document.getElementById('generateContractBtn').addEventListener('click', () => this.generateContract());
                document.getElementById('printContractBtn')?.addEventListener('click', () => this.printContract());
                
                // Settings events
                document.getElementById('saveSettingsBtn').addEventListener('click', () => this.saveSettings());
                document.getElementById('exportAllBtn').addEventListener('click', () => this.exportAllData());
                document.getElementById('importBtn').addEventListener('click', () => document.getElementById('importFile').click());
                document.getElementById('importFile').addEventListener('change', (e) => this.importData(e));
                document.getElementById('clearAllBtn').addEventListener('click', () => this.clearAllData());
                document.getElementById('resetDemoBtn').addEventListener('click', () => this.resetDemoData());
                
                // Quick tools events
                document.getElementById('quickCalcBtn').addEventListener('click', () => this.quickCalculate());
                document.getElementById('phoneScriptBtn').addEventListener('click', () => this.generatePhoneScript());
                document.getElementById('textScriptBtn').addEventListener('click', () => this.generateTextScript());
                document.getElementById('emailScriptBtn').addEventListener('click', () => this.generateEmailScript());
                document.getElementById('zillowBtn').addEventListener('click', () => this.openComps('zillow'));
                document.getElementById('redfinBtn').addEventListener('click', () => this.openComps('redfin'));
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));
                
                // Modal click outside to close
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeModal(modal.id);
                        }
                    });
                });
            }
            
            // === TAB MANAGEMENT ===
            switchTab(tabName) {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Remove active class from nav tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Show selected tab
                const selectedTab = document.getElementById(tabName);
                if (selectedTab) {
                    selectedTab.classList.add('active');
                }
                
                // Add active class to nav tab
                document.querySelector(`[data-tab="${tabName}"]`)?.classList.add('active');
                
                // Update specific tab data
                this.updateTabSpecificData(tabName);
            }
            
            updateTabSpecificData(tabName) {
                switch (tabName) {
                    case 'dashboard':
                        this.updateDashboard();
                        break;
                    case 'leads':
                        this.renderLeads();
                        break;
                    case 'buyers':
                        this.renderBuyers();
                        break;
                    case 'campaigns':
                        this.renderCampaigns();
                        break;
                    case 'tasks':
                        this.renderTasks();
                        break;
                    case 'settings':
                        this.loadSettings();
                        this.updateStats();
                        break;
                }
            }
            
            // === MODAL MANAGEMENT ===
            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
                document.body.style.overflow = 'auto';
                this.clearForm(modalId);
                this.currentEditId = null;
                this.currentEditType = null;
            }
            
            clearForm(modalId) {
                const modal = document.getElementById(modalId);
                const inputs = modal.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else if (input.tagName === 'SELECT') {
                        input.selectedIndex = 0;
                    } else {
                        input.value = '';
                    }
                });
                
                // Clear error messages
                modal.querySelectorAll('.error-message').forEach(error => {
                    error.textContent = '';
                });
                
                // Remove error classes
                modal.querySelectorAll('.error').forEach(field => {
                    field.classList.remove('error');
                });
            }
            
            // === LEAD MANAGEMENT ===
            openLeadModal(leadId = null) {
                this.currentEditId = leadId;
                this.currentEditType = 'lead';
                
                if (leadId) {
                    const lead = this.data.leads.find(l => l.id === leadId);
                    if (lead) {
                        document.getElementById('leadModalTitle').textContent = 'Edit Lead';
                        this.populateLeadForm(lead);
                    }
                } else {
                    document.getElementById('leadModalTitle').textContent = 'Add New Lead';
                }
                
                this.openModal('leadModal');
            }
            
            populateLeadForm(lead) {
                document.getElementById('lead-address').value = lead.address || '';
                document.getElementById('lead-owner').value = lead.owner || '';
                document.getElementById('lead-phone').value = lead.phone || '';
                document.getElementById('lead-arv').value = lead.arv || '';
                document.getElementById('lead-repairs').value = lead.repairs || '';
                document.getElementById('lead-status').value = lead.status || 'new';
                document.getElementById('lead-fee').value = lead.assignmentFee || this.data.settings.defaultFee;
                document.getElementById('lead-notes').value = lead.notes || '';
                document.getElementById('lead-followup').value = lead.followup || '';
            }
            
            validateLeadForm() {
                const address = document.getElementById('lead-address').value.trim();
                const arv = parseFloat(document.getElementById('lead-arv').value);
                
                let isValid = true;
                
                // Clear previous errors
                document.querySelectorAll('#leadModal .error-message').forEach(error => {
                    error.textContent = '';
                });
                document.querySelectorAll('#leadModal .error').forEach(field => {
                    field.classList.remove('error');
                });
                
                if (!address) {
                    this.showFieldError('lead-address', 'Property address is required');
                    isValid = false;
                }
                
                if (!arv || arv <= 0) {
                    this.showFieldError('lead-arv', 'Valid ARV is required');
                    isValid = false;
                }
                
                return isValid;
            }
            
            showFieldError(fieldId, message) {
                const field = document.getElementById(fieldId);
                const errorDiv = document.getElementById(fieldId + '-error');
                
                field.classList.add('error');
                if (errorDiv) {
                    errorDiv.textContent = message;
                }
            }
            
            saveLead() {
                if (!this.validateLeadForm()) {
                    return;
                }
                
                const leadData = {
                    address: document.getElementById('lead-address').value.trim(),
                    owner: document.getElementById('lead-owner').value.trim(),
                    phone: document.getElementById('lead-phone').value.trim(),
                    arv: parseFloat(document.getElementById('lead-arv').value) || 0,
                    repairs: parseFloat(document.getElementById('lead-repairs').value) || 0,
                    status: document.getElementById('lead-status').value,
                    assignmentFee: parseFloat(document.getElementById('lead-fee').value) || this.data.settings.defaultFee,
                    notes: document.getElementById('lead-notes').value.trim(),
                    followup: document.getElementById('lead-followup').value
                };
                
                // Calculate MAO
                leadData.mao = this.calculateMAO(leadData.arv, leadData.repairs, leadData.assignmentFee);
                
                if (this.currentEditId) {
                    // Update existing lead
                    const index = this.data.leads.findIndex(l => l.id === this.currentEditId);
                    if (index !== -1) {
                        this.data.leads[index] = { ...this.data.leads[index], ...leadData };
                        this.showNotification('Lead updated successfully!', 'success');
                    }
                } else {
                    // Add new lead
                    leadData.id = this.generateId();
                    leadData.dateAdded = new Date().toISOString();
                    leadData.lastContact = null;
                    
                    this.data.leads.push(leadData);
                    this.showNotification('Lead added successfully!', 'success');
                }
                
                this.saveData();
                this.renderLeads();
                this.updateDashboard();
                this.closeModal('leadModal');
            }
            
            calculateMAO(arv, repairs, assignmentFee, formula = 70) {
                const percentage = formula / 100;
                return Math.round((arv * percentage) - repairs - assignmentFee);
            }
            
            deleteLead(id) {
                if (confirm('Are you sure you want to delete this lead? This action cannot be undone.')) {
                    this.data.leads = this.data.leads.filter(lead => lead.id !== id);
                    this.saveData();
                    this.renderLeads();
                    this.updateDashboard();
                    this.showNotification('Lead deleted successfully!', 'success');
                }
            }
            
            renderLeads() {
                const tbody = document.getElementById('leadsTable');
                if (!tbody) return;
                
                if (this.data.leads.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: #6b7280;">
                                No leads yet. Click "Add New Lead" to start building your pipeline!
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Sort leads by date added (newest first)
                const sortedLeads = [...this.data.leads].sort((a, b) => 
                    new Date(b.dateAdded) - new Date(a.dateAdded)
                );
                
                tbody.innerHTML = sortedLeads.map(lead => {
                    const profit = lead.mao > 0 ? lead.assignmentFee || this.data.settings.defaultFee : 0;
                    const maoDisplay = lead.mao > 0 ? `$${lead.mao.toLocaleString()}` : 'N/A';
                    const profitDisplay = profit > 0 ? `$${profit.toLocaleString()}` : 'N/A';
                    
                    return `
                        <tr onclick="this.style.backgroundColor = this.style.backgroundColor ? '' : '#f9fafb'" style="cursor: pointer;">
                            <td><strong>${lead.address}</strong></td>
                            <td>${lead.owner || '-'}</td>
                            <td><span class="status-badge status-${lead.status}">${lead.status.toUpperCase()}</span></td>
                            <td>$${lead.arv.toLocaleString()}</td>
                            <td>$${lead.repairs.toLocaleString()}</td>
                            <td><strong>${maoDisplay}</strong></td>
                            <td><strong style="color: var(--success);">${profitDisplay}</strong></td>
                            <td>${lead.followup || 'Not set'}</td>
                            <td>
                                <button class="btn btn-primary" onclick="app.openLeadModal(${lead.id})" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">Edit</button>
                                <button class="btn btn-danger" onclick="app.deleteLead(${lead.id})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                            </td>
                        </tr>
                    `;
                }).join('');
                
                // Update task modal lead dropdown
                this.updateTaskLeadOptions();
            }
            
            updateTaskLeadOptions() {
                const taskLeadSelect = document.getElementById('task-lead');
                if (taskLeadSelect) {
                    taskLeadSelect.innerHTML = '<option value="">None</option>' + 
                        this.data.leads.map(lead => 
                            `<option value="${lead.id}">${lead.address}</option>`
                        ).join('');
                }
            }
            
            exportLeads() {
                if (this.data.leads.length === 0) {
                    this.showNotification('No leads to export!', 'warning');
                    return;
                }
                
                const headers = ['Address', 'Owner', 'Phone', 'ARV', 'Repairs', 'MAO', 'Assignment Fee', 'Status', 'Notes', 'Follow-up', 'Date Added'];
                const csvContent = [
                    headers.join(','),
                    ...this.data.leads.map(lead => [
                        `"${lead.address}"`,
                        `"${lead.owner || ''}"`,
                        `"${lead.phone || ''}"`,
                        lead.arv,
                        lead.repairs,
                        lead.mao,
                        lead.assignmentFee || 0,
                        `"${lead.status}"`,
                        `"${lead.notes || ''}"`,
                        `"${lead.followup || ''}"`,
                        `"${new Date(lead.dateAdded).toLocaleDateString()}"`
                    ].join(','))
                ].join('\n');
                
                this.downloadFile(csvContent, `leads_export_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
                this.showNotification('Leads exported successfully!', 'success');
            }
            
            matchBuyers() {
                if (this.data.leads.length === 0 || this.data.buyers.length === 0) {
                    this.showNotification('Need both leads and buyers to match!', 'warning');
                    return;
                }
                
                const matches = [];
                
                this.data.leads.forEach(lead => {
                    if (lead.status === 'contract' || lead.status === 'offer') {
                        this.data.buyers.forEach(buyer => {
                            const leadPrice = lead.mao + (lead.assignmentFee || this.data.settings.defaultFee);
                            
                            if (leadPrice >= buyer.minPrice && leadPrice <= buyer.maxPrice) {
                                matches.push({ lead, buyer, price: leadPrice });
                            }
                        });
                    }
                });
                
                if (matches.length === 0) {
                    this.showNotification('No buyer matches found for current leads.', 'warning');
                    return;
                }
                
                let matchText = `Found ${matches.length} potential matches:\n\n`;
                matches.forEach(match => {
                    matchText += `${match.lead.address} → ${match.buyer.name} (${match.buyer.company || 'No Company'})\n`;
                    matchText += `Price: $${match.price.toLocaleString()} | Phone: ${match.buyer.phone}\n\n`;
                });
                
                alert(matchText);
                this.showNotification(`Found ${matches.length} buyer matches!`, 'success');
            }
            
            // === BUYER MANAGEMENT ===
            openBuyerModal(buyerId = null) {
                this.currentEditId = buyerId;
                this.currentEditType = 'buyer';
                
                if (buyerId) {
                    const buyer = this.data.buyers.find(b => b.id === buyerId);
                    if (buyer) {
                        document.getElementById('buyerModalTitle').textContent = 'Edit Buyer';
                        this.populateBuyerForm(buyer);
                    }
                } else {
                    document.getElementById('buyerModalTitle').textContent = 'Add Cash Buyer';
                }
                
                this.openModal('buyerModal');
            }
            
            populateBuyerForm(buyer) {
                document.getElementById('buyer-name').value = buyer.name || '';
                document.getElementById('buyer-company').value = buyer.company || '';
                document.getElementById('buyer-phone').value = buyer.phone || '';
                document.getElementById('buyer-email').value = buyer.email || '';
                document.getElementById('buyer-areas').value = buyer.areas || '';
                document.getElementById('buyer-minprice').value = buyer.minPrice || '';
                document.getElementById('buyer-maxprice').value = buyer.maxPrice || '';
                document.getElementById('buyer-cash').value = buyer.cashAvailable || '';
                document.getElementById('buyer-timeline').value = buyer.closingTimeline || '14';
                document.getElementById('buyer-notes').value = buyer.notes || '';
                
                // Handle multiple select
                const typesSelect = document.getElementById('buyer-types');
                Array.from(typesSelect.options).forEach(option => {
                    option.selected = buyer.types?.includes(option.value) || false;
                });
            }
            
            validateBuyerForm() {
                const name = document.getElementById('buyer-name').value.trim();
                const phone = document.getElementById('buyer-phone').value.trim();
                
                let isValid = true;
                
                // Clear previous errors
                document.querySelectorAll('#buyerModal .error-message').forEach(error => {
                    error.textContent = '';
                });
                document.querySelectorAll('#buyerModal .error').forEach(field => {
                    field.classList.remove('error');
                });
                
                if (!name) {
                    this.showFieldError('buyer-name', 'Buyer name is required');
                    isValid = false;
                }
                
                if (!phone) {
                    this.showFieldError('buyer-phone', 'Phone number is required');
                    isValid = false;
                }
                
                return isValid;
            }
            
            saveBuyer() {
                if (!this.validateBuyerForm()) {
                    return;
                }
                
                const selectedTypes = Array.from(document.getElementById('buyer-types').selectedOptions)
                    .map(option => option.value);
                
                const buyerData = {
                    name: document.getElementById('buyer-name').value.trim(),
                    company: document.getElementById('buyer-company').value.trim(),
                    phone: document.getElementById('buyer-phone').value.trim(),
                    email: document.getElementById('buyer-email').value.trim(),
                    areas: document.getElementById('buyer-areas').value.trim(),
                    minPrice: parseFloat(document.getElementById('buyer-minprice').value) || 0,
                    maxPrice: parseFloat(document.getElementById('buyer-maxprice').value) || 0,
                    cashAvailable: parseFloat(document.getElementById('buyer-cash').value) || 0,
                    closingTimeline: parseInt(document.getElementById('buyer-timeline').value) || 14,
                    types: selectedTypes,
                    notes: document.getElementById('buyer-notes').value.trim()
                };
                
                if (this.currentEditId) {
                    // Update existing buyer
                    const index = this.data.buyers.findIndex(b => b.id === this.currentEditId);
                    if (index !== -1) {
                        this.data.buyers[index] = { ...this.data.buyers[index], ...buyerData };
                        this.showNotification('Buyer updated successfully!', 'success');
                    }
                } else {
                    // Add new buyer
                    buyerData.id = this.generateId();
                    buyerData.dateAdded = new Date().toISOString();
                    buyerData.lastContact = null;
                    buyerData.purchaseHistory = [];
                    
                    this.data.buyers.push(buyerData);
                    this.showNotification('Buyer added successfully!', 'success');
                }
                
                this.saveData();
                this.renderBuyers();
                this.closeModal('buyerModal');
            }
            
            deleteBuyer(id) {
                if (confirm('Are you sure you want to delete this buyer?')) {
                    this.data.buyers = this.data.buyers.filter(buyer => buyer.id !== id);
                    this.saveData();
                    this.renderBuyers();
                    this.showNotification('Buyer deleted successfully!', 'success');
                }
            }
            
            renderBuyers() {
                const tbody = document.getElementById('buyersTable');
                if (!tbody) return;
                
                if (this.data.buyers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: #6b7280;">
                                No buyers yet. Start building your buyers list!
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = this.data.buyers.map(buyer => {
                    const priceRange = buyer.minPrice || buyer.maxPrice ? 
                        `$${(buyer.minPrice || 0).toLocaleString()} - $${(buyer.maxPrice || 0).toLocaleString()}` : 
                        'Not specified';
                    
                    const lastContact = buyer.lastContact ? 
                        new Date(buyer.lastContact).toLocaleDateString() : 
                        'Never';
                    
                    return `
                        <tr onclick="this.style.backgroundColor = this.style.backgroundColor ? '' : '#f9fafb'" style="cursor: pointer;">
                            <td><strong>${buyer.name}</strong></td>
                            <td>${buyer.company || '-'}</td>
                            <td><a href="tel:${buyer.phone}">${buyer.phone}</a></td>
                            <td>${buyer.email ? `<a href="mailto:${buyer.email}">${buyer.email}</a>` : '-'}</td>
                            <td>${buyer.areas || '-'}</td>
                            <td>${priceRange}</td>
                            <td>${buyer.types?.join(', ') || '-'}</td>
                            <td>${lastContact}</td>
                            <td>
                                <button class="btn btn-primary" onclick="app.openBuyerModal(${buyer.id})" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">Edit</button>
                                <button class="btn btn-danger" onclick="app.deleteBuyer(${buyer.id})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            exportBuyers() {
                if (this.data.buyers.length === 0) {
                    this.showNotification('No buyers to export!', 'warning');
                    return;
                }
                
                const headers = ['Name', 'Company', 'Phone', 'Email', 'Areas', 'Min Price', 'Max Price', 'Cash Available', 'Types', 'Timeline', 'Notes'];
                const csvContent = [
                    headers.join(','),
                    ...this.data.buyers.map(buyer => [
                        `"${buyer.name}"`,
                        `"${buyer.company || ''}"`,
                        `"${buyer.phone}"`,
                        `"${buyer.email || ''}"`,
                        `"${buyer.areas || ''}"`,
                        buyer.minPrice || 0,
                        buyer.maxPrice || 0,
                        buyer.cashAvailable || 0,
                        `"${buyer.types?.join(';') || ''}"`,
                        buyer.closingTimeline || 14,
                        `"${buyer.notes || ''}"`
                    ].join(','))
                ].join('\n');
                
                this.downloadFile(csvContent, `buyers_export_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
                this.showNotification('Buyers exported successfully!', 'success');
            }
            
            // === CAMPAIGN MANAGEMENT ===
            openCampaignModal(campaignId = null) {
                this.currentEditId = campaignId;
                this.currentEditType = 'campaign';
                
                if (campaignId) {
                    const campaign = this.data.campaigns.find(c => c.id === campaignId);
                    if (campaign) {
                        document.getElementById('campaignModalTitle').textContent = 'Edit Campaign';
                        this.populateCampaignForm(campaign);
                    }
                } else {
                    document.getElementById('campaignModalTitle').textContent = 'New Marketing Campaign';
                }
                
                this.openModal('campaignModal');
            }
            
            populateCampaignForm(campaign) {
                document.getElementById('campaign-name').value = campaign.name || '';
                document.getElementById('campaign-channel').value = campaign.channel || 'Direct Mail';
                document.getElementById('campaign-budget').value = campaign.budget || '';
                document.getElementById('campaign-start').value = campaign.startDate || '';
                document.getElementById('campaign-end').value = campaign.endDate || '';
                document.getElementById('campaign-audience').value = campaign.audience || '';
                document.getElementById('campaign-expected').value = campaign.expectedLeads || '';
                document.getElementById('campaign-target-cpl').value = campaign.targetCPL || this.data.settings.targetCPL;
                document.getElementById('campaign-notes').value = campaign.notes || '';
            }
            
            validateCampaignForm() {
                const name = document.getElementById('campaign-name').value.trim();
                const budget = parseFloat(document.getElementById('campaign-budget').value);
                
                let isValid = true;
                
                // Clear previous errors
                document.querySelectorAll('#campaignModal .error-message').forEach(error => {
                    error.textContent = '';
                });
                document.querySelectorAll('#campaignModal .error').forEach(field => {
                    field.classList.remove('error');
                });
                
                if (!name) {
                    this.showFieldError('campaign-name', 'Campaign name is required');
                    isValid = false;
                }
                
                if (!budget || budget <= 0) {
                    this.showFieldError('campaign-budget', 'Valid budget is required');
                    isValid = false;
                }
                
                return isValid;
            }
            
            saveCampaign() {
                if (!this.validateCampaignForm()) {
                    return;
                }
                
                const campaignData = {
                    name: document.getElementById('campaign-name').value.trim(),
                    channel: document.getElementById('campaign-channel').value,
                    budget: parseFloat(document.getElementById('campaign-budget').value) || 0,
                    startDate: document.getElementById('campaign-start').value,
                    endDate: document.getElementById('campaign-end').value,
                    audience: document.getElementById('campaign-audience').value.trim(),
                    expectedLeads: parseInt(document.getElementById('campaign-expected').value) || 0,
                    targetCPL: parseFloat(document.getElementById('campaign-target-cpl').value) || this.data.settings.targetCPL,
                    notes: document.getElementById('campaign-notes').value.trim()
                };
                
                if (this.currentEditId) {
                    // Update existing campaign
                    const index = this.data.campaigns.findIndex(c => c.id === this.currentEditId);
                    if (index !== -1) {
                        this.data.campaigns[index] = { ...this.data.campaigns[index], ...campaignData };
                        this.showNotification('Campaign updated successfully!', 'success');
                    }
                } else {
                    // Add new campaign
                    campaignData.id = this.generateId();
                    campaignData.dateCreated = new Date().toISOString();
                    campaignData.spent = 0;
                    campaignData.leads = 0;
                    campaignData.conversions = 0;
                    campaignData.status = 'active';
                    
                    this.data.campaigns.push(campaignData);
                    this.showNotification('Campaign added successfully!', 'success');
                }
                
                this.saveData();
                this.renderCampaigns();
                this.closeModal('campaignModal');
            }
            
            deleteCampaign(id) {
                if (confirm('Are you sure you want to delete this campaign?')) {
                    this.data.campaigns = this.data.campaigns.filter(campaign => campaign.id !== id);
                    this.saveData();
                    this.renderCampaigns();
                    this.showNotification('Campaign deleted successfully!', 'success');
                }
            }
            
            renderCampaigns() {
                const tbody = document.getElementById('campaignsTable');
                if (!tbody) return;
                
                if (this.data.campaigns.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="11" style="text-align: center; padding: 40px; color: #6b7280;">
                                No campaigns yet. Track your marketing efforts!
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = this.data.campaigns.map(campaign => {
                    const cpl = campaign.leads > 0 ? Math.round(campaign.spent / campaign.leads) : 0;
                    const conversion = campaign.leads > 0 ? Math.round((campaign.conversions / campaign.leads) * 100) : 0;
                    const roi = campaign.spent > 0 ? Math.round(((campaign.conversions * this.data.settings.defaultFee - campaign.spent) / campaign.spent) * 100) : 0;
                    
                    return `
                        <tr onclick="this.style.backgroundColor = this.style.backgroundColor ? '' : '#f9fafb'" style="cursor: pointer;">
                            <td><strong>${campaign.name}</strong></td>
                            <td>${campaign.channel}</td>
                            <td>${campaign.startDate || '-'}</td>
                            <td>$${campaign.budget.toLocaleString()}</td>
                            <td>$${campaign.spent.toLocaleString()}</td>
                            <td>${campaign.leads}</td>
                            <td>$${cpl}</td>
                            <td>${conversion}%</td>
                            <td style="color: ${roi >= 0 ? 'var(--success)' : 'var(--danger)'};">${roi}%</td>
                            <td><span class="status-badge status-${campaign.status === 'active' ? 'contacted' : 'dead'}">${campaign.status.toUpperCase()}</span></td>
                            <td>
                                <button class="btn btn-primary" onclick="app.openCampaignModal(${campaign.id})" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">Edit</button>
                                <button class="btn btn-danger" onclick="app.deleteCampaign(${campaign.id})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                            </td>
                        </tr>
                    `;
                }).join('');
                
                this.updateCampaignStats();
            }
            
            updateCampaignStats() {
                const totalSpend = this.data.campaigns.reduce((sum, c) => sum + c.spent, 0);
                const totalBudget = this.data.campaigns.reduce((sum, c) => sum + c.budget, 0);
                const totalLeads = this.data.campaigns.reduce((sum, c) => sum + c.leads, 0);
                const avgCPL = totalLeads > 0 ? Math.round(totalSpend / totalLeads) : 0;
                
                // Find best channel
                const channelStats = {};
                this.data.campaigns.forEach(campaign => {
                    if (!channelStats[campaign.channel]) {
                        channelStats[campaign.channel] = { leads: 0, spent: 0 };
                    }
                    channelStats[campaign.channel].leads += campaign.leads;
                    channelStats[campaign.channel].spent += campaign.spent;
                });
                
                let bestChannel = '-';
                let bestROI = 0;
                Object.keys(channelStats).forEach(channel => {
                    const roi = channelStats[channel].spent > 0 ? 
                        (channelStats[channel].leads * this.data.settings.defaultFee - channelStats[channel].spent) / channelStats[channel].spent : 0;
                    if (roi > bestROI) {
                        bestROI = roi;
                        bestChannel = channel;
                    }
                });
                
                // Update DOM
                this.updateElement('totalSpend', totalSpend.toLocaleString());
                this.updateElement('budgetRemaining', (totalBudget - totalSpend).toLocaleString());
                this.updateElement('campaignLeads', totalLeads);
                this.updateElement('monthlyLeads', this.getMonthlyLeads());
                this.updateElement('campaignCPL', avgCPL.toLocaleString());
                this.updateElement('bestChannel', bestChannel);
                this.updateElement('bestROI', Math.round(bestROI * 100) + '%');
            }
            
            getMonthlyLeads() {
                const thisMonth = new Date();
                return this.data.leads.filter(lead => {
                    const leadDate = new Date(lead.dateAdded);
                    return leadDate.getMonth() === thisMonth.getMonth() && 
                           leadDate.getFullYear() === thisMonth.getFullYear();
                }).length;
            }
            
            // === TASK MANAGEMENT ===
            openTaskModal(taskId = null) {
                this.currentEditId = taskId;
                this.currentEditType = 'task';
                
                if (taskId) {
                    const task = this.data.tasks.find(t => t.id === taskId);
                    if (task) {
                        document.getElementById('taskModalTitle').textContent = 'Edit Task';
                        this.populateTaskForm(task);
                    }
                } else {
                    document.getElementById('taskModalTitle').textContent = 'Add Task';
                }
                
                this.openModal('taskModal');
            }
            
            populateTaskForm(task) {
                document.getElementById('task-title').value = task.title || '';
                document.getElementById('task-description').value = task.description || '';
                document.getElementById('task-priority').value = task.priority || 'medium';
                document.getElementById('task-due').value = task.dueDate || '';
                document.getElementById('task-lead').value = task.leadId || '';
                document.getElementById('task-type').value = task.type || 'follow-up';
            }
            
            validateTaskForm() {
                const title = document.getElementById('task-title').value.trim();
                
                let isValid = true;
                
                // Clear previous errors
                document.querySelectorAll('#taskModal .error-message').forEach(error => {
                    error.textContent = '';
                });
                document.querySelectorAll('#taskModal .error').forEach(field => {
                    field.classList.remove('error');
                });
                
                if (!title) {
                    this.showFieldError('task-title', 'Task title is required');
                    isValid = false;
                }
                
                return isValid;
            }
            
            saveTask() {
                if (!this.validateTaskForm()) {
                    return;
                }
                
                const taskData = {
                    title: document.getElementById('task-title').value.trim(),
                    description: document.getElementById('task-description').value.trim(),
                    priority: document.getElementById('task-priority').value,
                    dueDate: document.getElementById('task-due').value,
                    leadId: document.getElementById('task-lead').value || null,
                    type: document.getElementById('task-type').value
                };
                
                if (this.currentEditId) {
                    // Update existing task
                    const index = this.data.tasks.findIndex(t => t.id === this.currentEditId);
                    if (index !== -1) {
                        this.data.tasks[index] = { ...this.data.tasks[index], ...taskData };
                        this.showNotification('Task updated successfully!', 'success');
                    }
                } else {
                    // Add new task
                    taskData.id = this.generateId();
                    taskData.dateCreated = new Date().toISOString();
                    taskData.status = 'todo';
                    taskData.completedDate = null;
                    
                    this.data.tasks.push(taskData);
                    this.showNotification('Task added successfully!', 'success');
                }
                
                this.saveData();
                this.renderTasks();
                this.updateDashboard();
                this.closeModal('taskModal');
            }
            
            updateTaskStatus(id, newStatus) {
                const task = this.data.tasks.find(t => t.id === id);
                if (task) {
                    task.status = newStatus;
                    if (newStatus === 'completed') {
                        task.completedDate = new Date().toISOString();
                    } else {
                        task.completedDate = null;
                    }
                    
                    this.saveData();
                    this.renderTasks();
                    this.updateDashboard();
                    this.showNotification(`Task marked as ${newStatus}!`, 'success');
                }
            }
            
            deleteTask(id) {
                if (confirm('Are you sure you want to delete this task?')) {
                    this.data.tasks = this.data.tasks.filter(task => task.id !== id);
                    this.saveData();
                    this.renderTasks();
                    this.updateDashboard();
                    this.showNotification('Task deleted successfully!', 'success');
                }
            }
            
            renderTasks() {
                const todoContainer = document.getElementById('todoTasks');
                const progressContainer = document.getElementById('progressTasks');
                const completedContainer = document.getElementById('completedTasks');
                
                if (!todoContainer || !progressContainer || !completedContainer) return;
                
                const todoTasks = this.data.tasks.filter(t => t.status === 'todo');
                const progressTasks = this.data.tasks.filter(t => t.status === 'progress');
                const completedTasks = this.data.tasks.filter(t => t.status === 'completed');
                
                // Update counts
                this.updateElement('todoCount', todoTasks.length);
                this.updateElement('progressCount', progressTasks.length);
                this.updateElement('completedCount', completedTasks.length);
                
                // Render task cards
                todoContainer.innerHTML = todoTasks.length ? 
                    todoTasks.map(task => this.createTaskCard(task)).join('') : 
                    '<p style="color: #6b7280; text-align: center;">No pending tasks</p>';
                
                progressContainer.innerHTML = progressTasks.length ? 
                    progressTasks.map(task => this.createTaskCard(task)).join('') : 
                    '<p style="color: #6b7280; text-align: center;">No tasks in progress</p>';
                
                completedContainer.innerHTML = completedTasks.length ? 
                    completedTasks.slice(0, 5).map(task => this.createTaskCard(task)).join('') : 
                    '<p style="color: #6b7280; text-align: center;">No completed tasks</p>';
            }
            
            createTaskCard(task) {
                const dueDate = task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'No due date';
                const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status !== 'completed';
                const leadInfo = task.leadId ? this.data.leads.find(l => l.id == task.leadId) : null;
                
                return `
                    <div class="task-card ${task.priority}" ${isOverdue ? 'style="border-left-color: var(--danger);"' : ''}>
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            ${dueDate} • ${task.priority.toUpperCase()} priority
                            ${isOverdue ? ' • <span style="color: var(--danger);">OVERDUE</span>' : ''}
                            ${leadInfo ? `<br>Lead: ${leadInfo.address}` : ''}
                        </div>
                        <div class="task-actions">
                            ${task.status !== 'completed' ? `
                                <button class="btn btn-success task-actions" onclick="app.updateTaskStatus(${task.id}, 'completed')">✓</button>
                            ` : ''}
                            ${task.status === 'todo' ? `
                                <button class="btn btn-primary task-actions" onclick="app.updateTaskStatus(${task.id}, 'progress')">→</button>
                            ` : ''}
                            <button class="btn btn-primary task-actions" onclick="app.openTaskModal(${task.id})">Edit</button>
                            <button class="btn btn-danger task-actions" onclick="app.deleteTask(${task.id})">×</button>
                        </div>
                    </div>
                `;
            }
            
            // === DEAL CALCULATOR ===
            calculateDeal() {
                const arv = parseFloat(document.getElementById('calc-arv').value) || 0;
                const repairs = parseFloat(document.getElementById('calc-repairs').value) || 0;
                const fee = parseFloat(document.getElementById('calc-fee').value) || this.data.settings.defaultFee;
                const holding = parseFloat(document.getElementById('calc-holding').value) || 0;
                const closing = parseFloat(document.getElementById('calc-closing').value) || 0;
                const formula = document.getElementById('calc-formula').value;
                
                let percentage = 0.7;
                if (formula === '65') percentage = 0.65;
                else if (formula === '75') percentage = 0.75;
                else if (formula === 'custom') {
                    percentage = (parseFloat(document.getElementById('calc-custom').value) || 70) / 100;
                    document.getElementById('customPercentGroup').style.display = 'block';
                } else {
                    document.getElementById('customPercentGroup').style.display = 'none';
                }
                
                const totalCosts = repairs + fee + holding + closing;
                const mao = (arv * percentage) - totalCosts;
                const buyerProfit = (arv * percentage) - repairs - holding - closing;
                const totalInvestment = mao + repairs + holding + closing;
                const roi = totalInvestment > 0 ? Math.round(((buyerProfit - mao) / totalInvestment) * 100) : 0;
                
                // Update display
                this.updateElement('maoAmount', '$' + Math.round(Math.max(0, mao)).toLocaleString());
                this.updateElement('buyerProfit', '$' + Math.round(Math.max(0, buyerProfit - mao)).toLocaleString());
                this.updateElement('assignmentFee', '$' + fee.toLocaleString());
                this.updateElement('totalInvestment', '$' + totalInvestment.toLocaleString());
                this.updateElement('calcROI', roi + '%');
                
                // Update color based on deal quality
                const maoElement = document.getElementById('maoAmount');
                if (mao > 0) {
                    maoElement.style.color = 'white';
                } else {
                    maoElement.style.color = '#ff6b6b';
                }
            }
            
            updateRepairEstimate() {
                const sqft = parseFloat(document.getElementById('calc-sqft').value) || 0;
                const condition = parseInt(document.getElementById('calc-condition').value) || 1;
                
                const repairs = {
                    roof: parseFloat(document.getElementById('repair-roof').value) || 0,
                    kitchen: parseFloat(document.getElementById('repair-kitchen').value) || 0,
                    bath: parseFloat(document.getElementById('repair-bath').value) || 0,
                    floor: parseFloat(document.getElementById('repair-floor').value) || 0,
                    paint: parseFloat(document.getElementById('repair-paint').value) || 0,
                    hvac: parseFloat(document.getElementById('repair-hvac').value) || 0
                };
                
                // Update individual cost displays
                Object.keys(repairs).forEach(key => {
                    this.updateElement(key + 'Cost', repairs[key].toLocaleString());
                });
                
                const total = Object.values(repairs).reduce((sum, cost) => sum + cost, 0);
                const perSqFt = sqft > 0 ? Math.round(total / sqft) : 0;
                
                this.updateElement('totalRepairEstimate', total.toLocaleString());
                this.updateElement('repairPerSqFt', perSqFt);
                this.updateElement('currentCondition', `Level ${condition}`);
                
                // Auto-update calculator
                document.getElementById('calc-repairs').value = total;
                this.calculateDeal();
            }
            
            saveDealFromCalculator() {
                const address = document.getElementById('calc-address').value.trim();
                if (!address) {
                    this.showNotification('Please enter a property address', 'warning');
                    return;
                }
                
                const arv = parseFloat(document.getElementById('calc-arv').value) || 0;
                const repairs = parseFloat(document.getElementById('calc-repairs').value) || 0;
                const fee = parseFloat(document.getElementById('calc-fee').value) || this.data.settings.defaultFee;
                
                if (arv <= 0) {
                    this.showNotification('Please enter a valid ARV', 'warning');
                    return;
                }
                
                const leadData = {
                    id: this.generateId(),
                    address: address,
                    owner: '',
                    phone: '',
                    arv: arv,
                    repairs: repairs,
                    assignmentFee: fee,
                    status: 'new',
                    notes: 'Added from Deal Analyzer',
                    followup: '',
                    dateAdded: new Date().toISOString(),
                    mao: this.calculateMAO(arv, repairs, fee)
                };
                
                this.data.leads.push(leadData);
                this.saveData();
                this.renderLeads();
                this.updateDashboard();
                this.showNotification('Deal saved to leads successfully!', 'success');
                
                // Clear calculator
                ['calc-address', 'calc-arv', 'calc-repairs'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                this.calculateDeal();
            }
            
            // === CONTRACT GENERATOR ===
            generateContract() {
                const address = document.getElementById('contract-address').value.trim();
                const price = parseFloat(document.getElementById('contract-price').value);
                const seller = document.getElementById('contract-seller').value.trim();
                const buyer = document.getElementById('contract-buyer').value.trim();
                
                if (!address || !price || !seller || !buyer) {
                    this.showNotification('Please fill in all required fields', 'warning');
                    return;
                }
                
                const earnest = parseFloat(document.getElementById('contract-earnest').value) || 100;
                const closing = document.getElementById('contract-closing').value;
                const inspection = parseInt(document.getElementById('contract-inspection').value) || 7;
                const type = document.getElementById('contract-type').value;
                const assignmentFee = parseFloat(document.getElementById('contract-assignment-fee').value) || 0;
                const titleCompany = document.getElementById('contract-title').value.trim();
                
                let contractHTML = this.generateContractHTML(type, {
                    address, price, seller, buyer, earnest, closing, inspection, assignmentFee, titleCompany
                });
                
                document.getElementById('contractContent').innerHTML = contractHTML;
                document.getElementById('contractOutput').style.display = 'block';
                this.showNotification('Contract generated successfully!', 'success');
            }
            
            generateContractHTML(type, data) {
                const today = new Date().toLocaleDateString();
                const closingDate = data.closing || '[TO BE DETERMINED]';
                
                if (type === 'purchase') {
                    return `
                        <div style="max-width: 800px; margin: 0 auto; font-family: 'Times New Roman', serif; line-height: 1.6;">
                            <h1 style="text-align: center; margin-bottom: 30px; font-size: 18px;">REAL ESTATE PURCHASE AGREEMENT</h1>
                            
                            <p style="margin-bottom: 20px;">This Purchase Agreement ("Agreement") is entered into on <strong>${today}</strong>, between:</p>
                            
                            <div style="margin: 20px 0;">
                                <p><strong>SELLER:</strong> ${data.seller}</p>
                                <p><strong>BUYER:</strong> ${data.buyer}</p>
                            </div>
                            
                            <h3>1. PROPERTY</h3>
                            <p>Seller agrees to sell and Buyer agrees to purchase the real property located at:</p>
                            <p style="margin-left: 20px; font-weight: bold;">${data.address}</p>
                            
                            <h3>2. PURCHASE PRICE</h3>
                            <p>The total purchase price for the Property shall be <strong>${data.price.toLocaleString()}</strong> ("Purchase Price").</p>
                            
                            <h3>3. EARNEST MONEY</h3>
                            <p>Buyer shall deposit <strong>${data.earnest.toLocaleString()}</strong> as earnest money within 48 hours of execution of this Agreement with ${data.titleCompany || 'the designated title company'}.</p>
                            
                            <h3>4. CLOSING</h3>
                            <p>Closing shall occur on or before <strong>${closingDate}</strong> at a location mutually agreed upon by the parties.</p>
                            
                            <h3>5. INSPECTION PERIOD</h3>
                            <p>Buyer shall have <strong>${data.inspection} days</strong> from the date of this Agreement to inspect the Property and approve its condition.</p>
                            
                            <h3>6. ASSIGNMENT RIGHTS</h3>
                            <p>Buyer shall have the right to assign this Agreement to another party with written notice to Seller.</p>
                            
                            <h3>7. SELLER'S WARRANTIES</h3>
                            <p>Seller warrants that they have full authority to sell the Property and that the Property is free of any undisclosed liens or encumbrances.</p>
                            
                            <h3>8. CLOSING COSTS</h3>
                            <p>Each party shall pay their own closing costs unless otherwise agreed in writing.</p>
                            
                            <div style="margin-top: 60px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 40px;">
                                    <div>
                                        <p>SELLER:</p>
                                        <div style="border-bottom: 1px solid black; width: 250px; margin: 20px 0;"></div>
                                        <p>${data.seller}</p>
                                        <p>Date: _______________</p>
                                    </div>
                                    <div>
                                        <p>BUYER:</p>
                                        <div style="border-bottom: 1px solid black; width: 250px; margin: 20px 0;"></div>
                                        <p>${data.buyer}</p>
                                        <p>Date: _______________</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (type === 'assignment') {
                    return `
                        <div style="max-width: 800px; margin: 0 auto; font-family: 'Times New Roman', serif; line-height: 1.6;">
                            <h1 style="text-align: center; margin-bottom: 30px; font-size: 18px;">ASSIGNMENT OF PURCHASE AGREEMENT</h1>
                            
                            <p style="margin-bottom: 20px;">This Assignment Agreement is entered into on <strong>${today}</strong>, between:</p>
                            
                            <div style="margin: 20px 0;">
                                <p><strong>ASSIGNOR:</strong> ${data.buyer}</p>
                                <p><strong>ASSIGNEE:</strong> [END BUYER NAME]</p>
                            </div>
                            
                            <h3>1. ASSIGNMENT OF RIGHTS</h3>
                            <p>Assignor hereby assigns all rights, title, and interest in the Purchase Agreement dated <strong>${today}</strong> for the property located at:</p>
                            <p style="margin-left: 20px; font-weight: bold;">${data.address}</p>
                            
                            <h3>2. ASSIGNMENT FEE</h3>
                            <p>In consideration for this assignment, Assignee agrees to pay Assignor an assignment fee of <strong>${data.assignmentFee.toLocaleString()}</strong> at closing.</p>
                            
                            <h3>3. ASSUMPTION OF OBLIGATIONS</h3>
                            <p>Assignee agrees to assume all obligations and responsibilities of the original Purchase Agreement, including but not limited to the purchase price of <strong>${data.price.toLocaleString()}</strong>.</p>
                            
                            <h3>4. CLOSING</h3>
                            <p>Closing shall occur on or before <strong>${closingDate}</strong>.</p>
                            
                            <h3>5. BINDING EFFECT</h3>
                            <p>This Assignment shall be binding upon the heirs, successors, and assigns of the parties.</p>
                            
                            <div style="margin-top: 60px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 40px;">
                                    <div>
                                        <p>ASSIGNOR:</p>
                                        <div style="border-bottom: 1px solid black; width: 250px; margin: 20px 0;"></div>
                                        <p>${data.buyer}</p>
                                        <p>Date: _______________</p>
                                    </div>
                                    <div>
                                        <p>ASSIGNEE:</p>
                                        <div style="border-bottom: 1px solid black; width: 250px; margin: 20px 0;"></div>
                                        <p>[END BUYER NAME]</p>
                                        <p>Date: _______________</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                return '<p>Contract type not supported yet.</p>';
            }
            
            printContract() {
                const contractContent = document.getElementById('contractContent').innerHTML;
                const printWindow = window.open('', '', 'height=600,width=800');
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>Contract - ${new Date().toLocaleDateString()}</title>
                            <style>
                                body { font-family: 'Times New Roman', serif; padding: 40px; }
                                @media print { body { margin: 0; } }
                            </style>
                        </head>
                        <body>${contractContent}</body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
            
            // === DASHBOARD MANAGEMENT ===
            updateDashboard() {
                this.updateHeaderStats();
                this.updateDashboardCards();
                this.updateRecentActivity();
            }
            
            updateHeaderStats() {
                // Calculate pipeline value
                const pipelineValue = this.data.leads
                    .filter(lead => lead.status !== 'dead' && lead.status !== 'sold')
                    .reduce((sum, lead) => sum + (lead.assignmentFee || this.data.settings.defaultFee), 0);
                
                // Active leads count
                const activeLeads = this.data.leads.filter(lead => 
                    lead.status !== 'dead' && lead.status !== 'sold'
                ).length;
                
                // Monthly profit (from sold deals)
                const thisMonth = new Date();
                const monthlyProfit = this.data.leads
                    .filter(lead => {
                        if (lead.status !== 'sold') return false;
                        const leadDate = new Date(lead.dateAdded);
                        return leadDate.getMonth() === thisMonth.getMonth() && 
                               leadDate.getFullYear() === thisMonth.getFullYear();
                    })
                    .reduce((sum, lead) => sum + (lead.assignmentFee || this.data.settings.defaultFee), 0);
                
                // Conversion rate
                const totalLeads = this.data.leads.length;
                const soldLeads = this.data.leads.filter(lead => lead.status === 'sold').length;
                const conversionRate = totalLeads > 0 ? Math.round((soldLeads / totalLeads) * 100) : 0;
                
                // Update DOM
                this.updateElement('totalDealsValue', ' + pipelineValue.toLocaleString());
                this.updateElement('activeLeadsCount', activeLeads);
                this.updateElement('monthlyProfit', ' + monthlyProfit.toLocaleString());
                this.updateElement('conversionRate', conversionRate + '%');
            }
            
            updateDashboardCards() {
                // Weekly leads
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                const weeklyLeads = this.data.leads.filter(lead => 
                    new Date(lead.dateAdded) > weekAgo
                ).length;
                
                // Deals under contract
                const contractDeals = this.data.leads.filter(lead => lead.status === 'contract');
                const contractValue = contractDeals.reduce((sum, lead) => 
                    sum + (lead.assignmentFee || this.data.settings.defaultFee), 0
                );
                
                // Today's follow-ups
                const today = new Date().toISOString().split('T')[0];
                const todayFollowups = this.data.leads.filter(lead => lead.followup === today).length;
                
                // Next follow-up
                const upcomingFollowups = this.data.leads
                    .filter(lead => lead.followup && new Date(lead.followup) >= new Date())
                    .sort((a, b) => new Date(a.followup) - new Date(b.followup));
                const nextFollowup = upcomingFollowups.length > 0 ? 
                    upcomingFollowups[0].address.substring(0, 30) + '...' : 'None';
                
                // Marketing ROI
                const totalSpend = this.data.campaigns.reduce((sum, c) => sum + c.spent, 0);
                const totalCampaignLeads = this.data.campaigns.reduce((sum, c) => sum + c.leads, 0);
                const costPerLead = totalCampaignLeads > 0 ? Math.round(totalSpend / totalCampaignLeads) : 0;
                const marketingROI = totalSpend > 0 ? 
                    Math.round(((totalCampaignLeads * this.data.settings.defaultFee - totalSpend) / totalSpend) * 100) : 0;
                
                // Update DOM
                this.updateElement('weeklyLeads', weeklyLeads);
                this.updateElement('contractCount', contractDeals.length);
                this.updateElement('contractValue', contractValue.toLocaleString());
                this.updateElement('todayFollowups', todayFollowups);
                this.updateElement('nextFollowup', nextFollowup);
                this.updateElement('marketingROI', marketingROI + '%');
                this.updateElement('costPerLead', costPerLead.toLocaleString());
            }
            
            updateRecentActivity() {
                const recentLeads = [...this.data.leads]
                    .sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded))
                    .slice(0, 10);
                
                const tbody = document.getElementById('recentActivity');
                if (!tbody) return;
                
                if (recentLeads.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #6b7280;">
                                No recent activity. Add your first lead to get started!
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = recentLeads.map(lead => {
                    const nextAction = this.getNextAction(lead);
                    const maoDisplay = lead.mao > 0 ? `${lead.mao.toLocaleString()}` : 'N/A';
                    
                    return `
                        <tr onclick="this.style.backgroundColor = this.style.backgroundColor ? '' : '#f9fafb'" style="cursor: pointer;">
                            <td>${new Date(lead.dateAdded).toLocaleDateString()}</td>
                            <td><strong>${lead.address}</strong></td>
                            <td><span class="status-badge status-${lead.status}">${lead.status.toUpperCase()}</span></td>
                            <td>${nextAction}</td>
                            <td><strong>${maoDisplay}</strong></td>
                        </tr>
                    `;
                }).join('');
            }
            
            getNextAction(lead) {
                if (lead.followup) {
                    const followupDate = new Date(lead.followup);
                    const today = new Date();
                    const diffTime = followupDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) return 'OVERDUE Follow-up';
                    if (diffDays === 0) return 'Follow-up TODAY';
                    if (diffDays === 1) return 'Follow-up Tomorrow';
                    return `Follow-up in ${diffDays} days`;
                }
                
                switch (lead.status) {
                    case 'new': return 'Initial contact';
                    case 'contacted': return 'Follow-up call';
                    case 'offer': return 'Await response';
                    case 'contract': return 'Schedule closing';
                    case 'sold': return 'Completed';
                    case 'dead': return 'Archived';
                    default: return 'No action set';
                }
            }
            
            updateAllDisplays() {
                this.updateDashboard();
                this.renderLeads();
                this.renderBuyers();
                this.renderCampaigns();
                this.renderTasks();
            }
            
            // === SETTINGS MANAGEMENT ===
            saveSettings() {
                this.data.settings = {
                    company: document.getElementById('settings-company').value.trim(),
                    name: document.getElementById('settings-name').value.trim(),
                    phone: document.getElementById('settings-phone').value.trim(),
                    email: document.getElementById('settings-email').value.trim(),
                    defaultFee: parseFloat(document.getElementById('settings-fee').value) || 10000,
                    targetCPL: parseFloat(document.getElementById('settings-cpl').value) || 100
                };
                
                this.saveData();
                this.showNotification('Settings saved successfully!', 'success');
            }
            
            loadSettings() {
                document.getElementById('settings-company').value = this.data.settings.company || '';
                document.getElementById('settings-name').value = this.data.settings.name || '';
                document.getElementById('settings-phone').value = this.data.settings.phone || '';
                document.getElementById('settings-email').value = this.data.settings.email || '';
                document.getElementById('settings-fee').value = this.data.settings.defaultFee || 10000;
                document.getElementById('settings-cpl').value = this.data.settings.targetCPL || 100;
            }
            
            updateStats() {
                const totalDeals = this.data.leads.filter(lead => lead.status === 'sold').length;
                const totalRevenue = this.data.leads
                    .filter(lead => lead.status === 'sold')
                    .reduce((sum, lead) => sum + (lead.assignmentFee || this.data.settings.defaultFee), 0);
                
                this.updateElement('statsLeads', this.data.leads.length);
                this.updateElement('statsBuyers', this.data.buyers.length);
                this.updateElement('statsDeals', totalDeals);
                this.updateElement('statsRevenue', totalRevenue.toLocaleString());
            }
            
            // === DATA IMPORT/EXPORT ===
            exportAllData() {
                const exportData = {
                    ...this.data,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                this.downloadFile(dataStr, `wholesalepro_backup_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
                this.showNotification('All data exported successfully!', 'success');
            }
            
            importData(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (confirm('This will replace all current data. Are you sure? This action cannot be undone.')) {
                            // Validate imported data structure
                            if (importedData.leads && importedData.buyers && importedData.campaigns && importedData.tasks) {
                                this.data = { ...this.data, ...importedData };
                                this.saveData();
                                this.updateAllDisplays();
                                this.loadSettings();
                                this.showNotification('Data imported successfully!', 'success');
                            } else {
                                this.showNotification('Invalid file format. Please select a valid backup file.', 'error');
                            }
                        }
                    } catch (error) {
                        console.error('Import error:', error);
                        this.showNotification('Error reading file. Please check the file format.', 'error');
                    }
                };
                reader.readAsText(file);
                
                // Clear file input
                event.target.value = '';
            }
            
            clearAllData() {
                if (confirm('This will delete ALL data permanently. Are you absolutely sure?')) {
                    if (confirm('Last chance! This action cannot be undone. Delete everything?')) {
                        this.data = {
                            leads: [],
                            buyers: [],
                            campaigns: [],
                            tasks: [],
                            settings: {
                                company: '',
                                name: '',
                                phone: '',
                                email: '',
                                defaultFee: 10000,
                                targetCPL: 100
                            },
                            lastId: 0
                        };
                        
                        this.saveData();
                        this.updateAllDisplays();
                        this.loadSettings();
                        this.showNotification('All data cleared successfully!', 'success');
                    }
                }
            }
            
            resetDemoData() {
                if (confirm('This will replace all data with demo data. Continue?')) {
                    this.data = this.createDemoData();
                    this.saveData();
                    this.updateAllDisplays();
                    this.loadSettings();
                    this.showNotification('Demo data loaded successfully!', 'success');
                }
            }
            
            createDemoData() {
                return {
                    leads: [
                        {
                            id: 1,
                            address: "123 Main St, Orlando, FL 32801",
                            owner: "John Smith",
                            phone: "(555) 123-4567",
                            arv: 250000,
                            repairs: 35000,
                            assignmentFee: 10000,
                            status: "contract",
                            notes: "Motivated seller, needs quick close",
                            followup: new Date(Date.now() + 86400000).toISOString().split('T')[0],
                            dateAdded: new Date().toISOString(),
                            mao: 165000
                        },
                        {
                            id: 2,
                            address: "456 Oak Ave, Tampa, FL 33601",
                            owner: "Mary Johnson",
                            phone: "(555) 987-6543",
                            arv: 180000,
                            repairs: 25000,
                            assignmentFee: 8000,
                            status: "offer",
                            notes: "Inherited property, out of state owner",
                            followup: "",
                            dateAdded: new Date(Date.now() - 172800000).toISOString(),
                            mao: 101000
                        }
                    ],
                    buyers: [
                        {
                            id: 3,
                            name: "Mike Wilson",
                            company: "Wilson Investments",
                            phone: "(555) 555-0123",
                            email: "mike@wilsoninvest.com",
                            areas: "Orlando, Tampa, Jacksonville",
                            minPrice: 80000,
                            maxPrice: 300000,
                            cashAvailable: 500000,
                            closingTimeline: 14,
                            types: ["SFH", "Multi"],
                            notes: "Prefers turnkey properties",
                            dateAdded: new Date().toISOString()
                        }
                    ],
                    campaigns: [
                        {
                            id: 4,
                            name: "Q1 Direct Mail Campaign",
                            channel: "Direct Mail",
                            budget: 5000,
                            startDate: "2025-01-01",
                            endDate: "2025-03-31",
                            audience: "Absentee owners, high equity",
                            expectedLeads: 50,
                            targetCPL: 100,
                            spent: 2500,
                            leads: 25,
                            conversions: 2,
                            status: "active",
                            notes: "Targeting 3+ bedroom homes built before 1990"
                        }
                    ],
                    tasks: [
                        {
                            id: 5,
                            title: "Follow up with John Smith",
                            description: "Check on contract status and closing date",
                            priority: "high",
                            dueDate: new Date().toISOString().split('T')[0],
                            leadId: 1,
                            type: "follow-up",
                            status: "todo",
                            dateCreated: new Date().toISOString()
                        }
                    ],
                    settings: {
                        company: "Demo Wholesaling LLC",
                        name: "Demo User",
                        phone: "(555) 123-DEMO",
                        email: "demo@wholesaling.com",
                        defaultFee: 10000,
                        targetCPL: 100
                    },
                    lastId: 5
                };
            }
            
            // === QUICK TOOLS ===
            quickCalculate() {
                const arv = parseFloat(document.getElementById('quickARV').value) || 0;
                const repairs = parseFloat(document.getElementById('quickRepairs').value) || 0;
                
                if (arv <= 0) {
                    document.getElementById('quickResult').innerHTML = 'Enter valid ARV';
                    return;
                }
                
                const mao = (arv * 0.7) - repairs - this.data.settings.defaultFee;
                const profit = this.data.settings.defaultFee;
                
                document.getElementById('quickResult').innerHTML = 
                    `MAO: ${Math.max(0, mao).toLocaleString()}<br>Your Profit: ${profit.toLocaleString()}`;
            }
            
            generatePhoneScript() {
                const script = `SELLER PHONE SCRIPT:

"Hi [Name], I hope I'm not catching you at a bad time. My name is [Your Name] and I'm a local real estate investor here in [City]. 

I noticed your property at [Address] and I'm wondering if you'd ever consider selling it?

I buy houses with cash, can close quickly in 7-14 days, and you don't have to worry about any repairs or realtor commissions. 

Would you be open to hearing a no-obligation cash offer?"

KEY POINTS:
• Emphasize CASH offer
• Quick closing (7-14 days)
• No repairs needed
• No realtor fees
• Listen more than you talk
• Be respectful of their time`;
                
                alert(script);
            }
            
            generateTextScript() {
                const script = `SMS TEMPLATE:

"Hi [Name], I'm [Your Name], a local investor. I'm interested in your property at [Address]. 

I can make a cash offer and close quickly with no repairs needed. 

Would you consider selling? Reply YES for more info."

FOLLOW-UP TEXTS:
1. "Just following up on my text about [Address]. Still interested in a quick cash sale?"
2. "Hi [Name], I can offer $[Amount] cash for [Address]. Can close in 2 weeks. Interested?"

TIPS:
• Keep messages short
• Always include property address
• Be direct but friendly
• Include opt-out option: "Reply STOP to opt out"`;
                
                alert(script);
            }
            
            generateEmailScript() {
                const script = `EMAIL TEMPLATE:

Subject: Cash Offer for [Property Address]

Dear [Name],

I hope this email finds you well. My name is [Your Name] and I'm a local real estate investor in the [City] area.

I came across your property at [Property Address] and I'm very interested in making you a cash offer.

Here's what I can offer:
✓ All-cash purchase (no financing delays)
✓ Close in as little as 7-14 days
✓ Buy AS-IS (no repairs needed)
✓ No realtor commissions or fees
✓ Flexible closing date

I understand that selling a home is a big decision. I'd be happy to discuss how I might be able to help with your situation.

Would you be interested in a no-obligation cash offer?

Best regards,
[Your Name]
[Your Company]
[Phone Number]
[Email]`;
                
                alert(script);
            }
            
            openComps(site) {
                const address = document.getElementById('compAddress').value.trim();
                if (!address) {
                    this.showNotification('Please enter a property address first', 'warning');
                    return;
                }
                
                const encodedAddress = encodeURIComponent(address);
                let url = '';
                
                switch (site) {
                    case 'zillow':
                        url = `https://www.zillow.com/homes/${encodedAddress}_rb/`;
                        break;
                    case 'redfin':
                        url = `https://www.redfin.com/stingray/do/location-search?location=${encodedAddress}`;
                        break;
                    default:
                        return;
                }
                
                window.open(url, '_blank');
            }
            
            // === UTILITY FUNCTIONS ===
            updateElement(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            }
            
            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
            
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            setDefaultDates() {
                const today = new Date().toISOString().split('T')[0];
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];
                
                // Set default dates
                const campaignStartEl = document.getElementById('campaign-start');
                const taskDueEl = document.getElementById('task-due');
                const contractClosingEl = document.getElementById('contract-closing');
                
                if (campaignStartEl) campaignStartEl.value = today;
                if (taskDueEl) taskDueEl.value = tomorrowStr;
                if (contractClosingEl) contractClosingEl.value = tomorrowStr;
            }
            
            handleKeyboard(e) {
                // Escape key - close modals
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        this.closeModal(modal.id);
                    });
                    return;
                }
                
                // Keyboard shortcuts (Alt + key)
                if (e.altKey) {
                    switch (e.key.toLowerCase()) {
                        case 'l':
                            e.preventDefault();
                            this.openLeadModal();
                            break;
                        case 'b':
                            e.preventDefault();
                            this.openBuyerModal();
                            break;
                        case 't':
                            e.preventDefault();
                            this.openTaskModal();
                            break;
                        case 'c':
                            e.preventDefault();
                            this.openCampaignModal();
                            break;
                        case 'd':
                            e.preventDefault();
                            this.switchTab('dashboard');
                            break;
                        case 'q':
                            e.preventDefault();
                            this.switchTab('calculator');
                            break;
                    }
                }
            }
        }
        
        // Initialize the application
        let app;
        
        document.addEventListener('DOMContentLoaded', function() {
            app = new WholesaleProApp();
            
            // Make app globally accessible for onclick handlers
            window.app = app;
            
            // Add some helpful console messages
            console.log('🚀 WholesalePro Ultimate loaded successfully!');
            console.log('💡 Keyboard shortcuts:');
            console.log('   Alt+L = New Lead');
            console.log('   Alt+B = New Buyer');
            console.log('   Alt+T = New Task');
            console.log('   Alt+C = New Campaign');
            console.log('   Alt+D = Dashboard');
            console.log('   Alt+Q = Deal Calculator');
            console.log('   Escape = Close modals');
        });
        
        // Expose functions globally for onclick handlers
        window.switchTab = function(tabName) {
            if (app) app.switchTab(tabName);
        };
    </script>
</body>
</html>
